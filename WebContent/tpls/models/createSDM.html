<!DOCTYPE html>
<html>
<head>
  <title>SDM管理系统</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <script src="/ModelManage/js/jquery.min.js"></script>
<script src="/ModelManage/js/bootstrap.min.js"></script>
 <link rel="stylesheet" href="/ModelManage/style/bootstrap.min2.css" type="text/css">
</head>
<body>
	<div align="left">
		<img src="/ModelManage/image/csdf.jpg">
	</div>
    <nav class="navbar navbar-default" style="margin-bottom:0;border:0;border-radius:0;">
      <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <a class="navbar-brand" href="#"><span class="glyphicon glyphicon-grain"></span>&nbsp;SDM管理系统</a>
        </div>

        <ul class="nav navbar-nav" style="float:right;">
			<li class="dropdown" class="active">
				<a href="#" class="dropdown-toggle" data-toggle="dropdown">
					个人信息 
					<b class="caret"></b>
				</a>
				<ul class="dropdown-menu">
					<li><a href="../admin/user/update_user.html">修改个人信息</a></li>
					<li><a href="../admin/user/update_pwd.html">修改密码</a></li>
				</ul>
			</li>
			<li ><a href="../login.html">退出登录</a></li>
		</ul>
       <span id="weluser" class="navbar-text"style="float:right;">欢迎登录，XXX</span>
      </div>
      </nav>
     
	<div class="row">
        <div class="col-xs-2"id="inn">
           <ul class="nav nav-pills nav-stacked" id="functionTab">
            <li class="0 active"><a href="#SDM" class="nav-header collapsed" data-toggle="collapse" data-parent="#functionTab"><span class="glyphicon glyphicon-user"></span>&nbsp;SDM</a>
             <ul id="SDM" class="nav nav-list secondmenu collapse " role="tabpanel" style="height: 0px;text-indent: 2em">
                <li onClick="getclassname(this)" ><a href="checkSDM.html" target="_parent" style="color: grey">查看并下载</a></li>
                <li onClick="getclassname(this)"><a href="#" target="_parent" style="color: grey">新建SDM</a></li>
                <li onClick="getclassname(this)"><a href="checkCR.html" target="_parent" style="color: grey">我的变更</a></li>  
              </ul></li>
            <li class="2"><a href="#myModel" class="nav-header collapsed" data-toggle="collapse" data-parent="#functionTab"><span class="glyphicon glyphicon-education"></span>&nbsp;我的模型</a>
            <ul id="myModel" class="nav nav-list secondmenu collapse" style="height: 0px;text-indent: 2em">
                <li onClick="getclassname(this)"><a href="checkModel.html" target="_parent" style="color: grey">查看并下载</a></li>
                <li onClick="getclassname(this)"><a href="createModel.html" target="_parent" style="color: grey">新建模型</a></li>
                <li onClick="getclassname(this)"><a href="updateModel.html" target="_parent" style="color: grey">更新模型</a></li>
              </ul></li>
            <li class="2"><a href="#code" class="nav-header collapsed" data-toggle="collapse" data-parent="#functionTab"><span class="glyphicon glyphicon-tree-conifer"></span>&nbsp;消息代码</a>
            <ul id="code" class="nav nav-list secondmenu collapse" style="height: 0px;text-indent: 2em">
                <li onClick="getclassname(this)"><a href="exportCode.html" target="_parent" style="color: grey">代码导出</a></li>
              </ul></li>
            <li role="presentation" class="3"><a href="checkCR_CCB.html"><span class="glyphicon glyphicon-book"></span>&nbsp;审核模型</a></li>
            <li role="presentation" class="4"><a href="checkCR_CCB.html"><span class="glyphicon glyphicon-book"></span>&nbsp;审核模型</a></li>
            <li role="presentation" class="5"><a href="admin/permission/manageUser.html"><span class="glyphicon glyphicon-user"></span>&nbsp;管理用户</a></li>
          </ul>
        </div>
    <div class="col-xs-10">
          <p class="biao"><a href="../../home.html">首页></a><a>SDM></a><a>新建SDM</a></p>
         <div class="col-xs-6">
          <form class="form-horizontal" method="POST">
           <div class="form-group">
                <label for="bigClass" class="col-xs-3 control-label"><span style="color:red">*</span>模型层次:</label>
                <div class="col-xs-3">
                 	 <select id="bigClass" class="form-control">
						<option value="1" id="basis">基础元素</option>
						<option value="2" id="extends">扩展元素</option>
					 </select>
				</div>
            </div>
            <div class="form-group">
                <label for="middleClass" class="col-xs-3 control-label"><span style="color:red">*</span>模型:</label>
                <div class="col-xs-5">
                     <select id="middleClass" class="form-control">
                     	<option value='0'>请选择</option>
						<option value="3" id="conceptual">Conceptual_Model</option>
						<option value="5" id="logical">Logical_Model</option>
					 </select>
				</div>
            </div>
          <div class="form-group">
                <label for="smallClass" class="col-xs-3 control-label"><span style="color:red">*</span>类型:</label>
                <div class="col-xs-5">
                 	 <select id="smallClass" class="form-control">
						<option value='0'>请选择</option>
					 </select>
				</div>
            </div>
            <div class="form-group" id="div_EnglishName">
              <label for="EnglishName" class="col-xs-3 control-label"><span style="color:red">*</span>元素名称：</label>
              <div class="col-xs-5">
                  <input type="text" class="form-control" id="EnglishName" name="EnglishName" style="float:left">
                  <span class="help-inline" id="help_EnglishName" style="color:red;float:right"></span>
              </div>
            </div>
            <div class="form-group" id="div_description">
              <label for="description" class="col-xs-3 control-label"><span style="color:red">*</span>描述：</label>
              <div class="col-xs-9">
             	 <textarea class="form-control" id="description" rows="4" cols="20" style="width:80%;float:left"></textarea>
                
                  <span class="help-inline" id="help_description" style="color:red;float:right"></span>
              </div>
            </div>
          
            <div class="form-group">
              <div class="col-xs-offset-3 col-xs-10" align="center">
                <input type="button" onclick="createModel()" class="btn btn-primary"style="font-size:1.5em;text-align:center;" value="确&nbsp;认&nbsp;提&nbsp;交">
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <button type="submit" class="btn btn-primary"style="font-size:1.5em;text-align:center;">取&nbsp;消</button>
              </div>
            </div>
          </form>
        </div>
</div>

  </body>
  <script src="/ModelManage/js/cookie.js"></script>
  <script>
  $(document).ready(function(){
	  $("#SDM").collapse('show');
	  if(checkCookie()){
	  var username=getCookie("username");
	  document.getElementById("weluser").innerHTML="欢迎登录，"+username;
	  var authority=getCookie("authority");
	 	 if(authority!=null){
			  for(var i=0;i<6;i++)	  
				  if($.inArray(i.toString(),authority.split(","))==-1)
				  		$("."+i).remove();
		  }  
  }
	  //找到下拉框
		 //给下拉框注册事件 
		 $("#middleClass").change(function(){ 
		  var middleValue = $(this).val(); 
		  if( middleValue == 3){ 
			   $("#smallClass").empty();
			   $("#smallClass").prepend("<option value='0'>请选择</option>");   //为Select插入一个Option(第一个位置)   
			   $("#smallClass").append("<option value='4' id='Observables'>Observables</option>");
			 
		  }else if(middleValue == 5){
			  $("#smallClass").empty();
			  $("#smallClass").prepend("<option value='0'>请选择</option>");   //为Select插入一个Option(第一个位置)   
			  $("#smallClass").append("<option value='6' id='CoordinateSystems'>CoordinateSystems</option>");
			  $("#smallClass").append("<option value='7' id='LogicalValueTypes'>LogicalValueTypes</option>");
			  $("#smallClass").append("<option value='8' id='Units'>Units</option>");
			  $("#smallClass").append("<option value='9' id='ValueTypeUnits'>ValueTypeUnits</option>");
			  $("#smallClass").append("<option value='10' id='LandMarks'>LandMarks</option>");
			  $("#smallClass").append("<option value='11' id='ReferencePoints'>ReferencePoints</option>");
			  $("#smallClass").append("<option value='12' id='Constraints'>Constraints</option>");
			  $("#smallClass").append("<option value='13' id='MeasurementSystems'>MeasurementSystems</option>");
			  $("#smallClass").append("<option value='14' id='Measurements'>Measurements</option>");
			  $("#smallClass").append("<option value='15' id='Enumerations'>Enumerations</option>");
		  }
		  else{ 
		   //carnameValue为空的情况，隐藏第二个下拉框 
		   	  $("#smallClass").empty();
			  $("#smallClass").empty();
		  } 
		 })
  })
   function valid() {
	//一下类型没有生效，不知道为什么
	document.getElementById("help_EnglishName").innerHTML = "";
	document.getElementById("help_description").innerHTML = "";
	var EnglishName = $("#EnglishName").val().trim();
	var description = $("#description").val().trim();
	if (EnglishName == "") {
		document.getElementById("help_EnglishName").innerHTML = "元素名称不能为空";
		return false;
	}
	if (description == "") {
		document.getElementById("help_description").innerHTML = "描述不能为空";
		return false;
	}
	return true;
}
   function createModel(){
	   if(valid()){
		   var date=new Date(); 
			  var dateString=date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate();
			   $.ajax({
			       type: "POST",
			       url: "/ModelManage/createSDM",    
			       data: {bigClass:$("#bigClass").val(), middleClass:$("#middleClass").val(),smallClass:$("#smallClass").val(),
			    	   EnglishName:$("#EnglishName").val(),
			    	   description:$("#description").val(), creator:getCookie("username"),state:0,createTime:dateString},
			       success: function(data) {
			         if(data==-2){
			       	 	 alert("名字输入错误！");
			         }
			         else if(data>=0) 
			        	 alert("创建成功！");
			         else
			        	 alert("创建失败！");
			       }
			     }); 
	   }	  
  }
   function uploadFile(elementID){
	 var formData =  new FormData(); 
	 formData.append("SDMFile", $('#SDMFile')[0].files[0]);
	 formData.append("elementID", elementID);
	     $.ajax({  
	          url: "/ModelManage/uploadModel" ,  
	          type: "POST",
	          data: formData,
	          //dataType:'text',
	          async: false,  
	          cache: false,  
	          contentType: false,  //不处理数据
	          processData: false,  //不设置内容
			 success: function(data) {
				 if(data!=null)
					alert("成功");
				 else 
					alert("失败");
			 },
			 error:function(){
				 alert("失败");
			 }
	     });  

}
	function logout(){
	  delCookie("username");
	  window.location.href="../../login.html";
  }
  </script>
</html>
        
